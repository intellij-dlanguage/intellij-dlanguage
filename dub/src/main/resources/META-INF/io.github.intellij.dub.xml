<idea-plugin>
    <resource-bundle>i18n.text</resource-bundle>

    <depends>com.intellij.modules.json</depends>
    <depends optional="true" config-file="dub-idea-only.xml">com.intellij.modules.java</depends>
    <depends optional="true" config-file="dub-clion-only.xml">com.intellij.modules.cidr.lang</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Windows are the bits generally displayed on right hand side of Intellij (eg: Ant,Maven,Gradle)-->
        <toolWindow id="DubToolBar" anchor="right" icon="/icons/dub-ball.png"
                    factoryClass="io.github.intellij.dub.toolwindow.DubToolWindow" />
        <localInspection language="JSON"
                         displayName="Invalid dependency version"
                         groupPath="D language"
                         groupName="Dub packages"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="io.github.intellij.dub.packageConfig.inspections.PackageVersionValidationInspection"/>

        <consoleFilterProvider implementation="io.github.intellij.dub.run.DubConsoleFilterProvider"/>
        <analyzeStacktraceFilter implementation="io.github.intellij.dub.run.DubBuildSourceFileFilter"/>

        <externalAnnotator language="D"
                           implementationClass="io.github.intellij.dub.highlighting.annotation.DubSyntaxAnnotator"/>

        <runConfigurationProducer implementation="io.github.intellij.dub.run.DlangRunDubConfigurationProducer"/>

        <configurationType implementation="io.github.intellij.dub.run.DlangRunDubConfigurationType"/>

        <programRunner implementation="io.github.intellij.dub.run.DubBuildRunner"/>

        <projectConfigurable provider="io.github.intellij.dub.project.settings.DubConfigurableProvider"
                             parentId="build.tools"
                             id="language.d.build.tool.dub"
                             bundle="i18n.text" key="settings.dlang.dub.name"/>

        <postStartupActivity
            implementation="io.github.intellij.dub.project.DubListenerComponent"/>

        <notificationGroup id="DUB run configuration"
                           displayType="BALLOON"/>
        <notificationGroup id="DubNotification"
                           displayType="BALLOON"/>
        <notificationGroup id="Dub"
                           displayType="BALLOON"/>
        <notificationGroup id="Dub Import"
                           displayType="BALLOON"/>
        <notificationGroup id="Process D Libs"
                           displayType="BALLOON"/>

        <!--<externalSystemManager id="DubManager" implementation="net.masterthought.dlanguage.dub.DubManager"/>-->
        <!--<externalSystemConfigLocator implementation="io.github.intellij.dub.ConfigLocator"/>-->
        <!--<externalProjectDataService implementation=""/>-->
        <!--<externalSystemViewContributor implementation=""/>-->
        <!--<externalProjectStructureCustomizer implementation=""/>-->
        <!--<externalSystemNotificationExtension implementation=""/>-->
        <!--<externalSystemTaskNotificationListener implementation=""/>-->
        <!--<externalSystemExecutionConsoleManager implementation=""/>-->
    </extensions>

    <extensions defaultExtensionNs="JavaScript">
        <JsonSchema.ProviderFactory implementation="io.github.intellij.dub.packageConfig.DubJsonSchemaProviderFactory"/>
    </extensions>

    <actions>
        <!-- Actions for Dub -->
        <action id="dub.build.action" class="io.github.intellij.dub.actions.DubBuildAction"
                text="_Run Dub"
                description="Run Dub using selected options"
                icon="AllIcons.Actions.Execute">
        </action>

        <action id="dub.settings.action" class="io.github.intellij.dub.actions.ConfigureDToolsAction"
                text="_Configure D Tools"
                icon="AllIcons.General.GearPlain">
        </action>

        <!-- Adds a group to the ToolsMenu that we can anchor multiple actions to -->
        <group id="dlang-dub-tools-menu-group"
               text="Dub (D Language)"
               popup="true" icon="/icons/dub-ball.png">
            <add-to-group group-id="ToolsMenu" anchor="last" />

            <action id="dub.process-libs.action"
                    class="io.github.intellij.dub.actions.ProcessDLibs">
            </action>

            <action id="dub.repo-usage.action"
                    class="io.github.intellij.dub.actions.DubRepoUsageAction">
            </action>
        </group>

    </actions>

</idea-plugin>
