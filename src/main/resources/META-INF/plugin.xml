<?xml version="1.0" encoding="utf-8" ?>
<!--<!DOCTYPE idea-plugin PUBLIC "Plugin/DTD" "http://plugins.intellij.net/plugin.dtd">-->
<idea-plugin>
    <id>net.masterthought.dlanguage</id>
    <name>D Language</name>
    <version>@version@</version>
    <vendor url="https://intellij-dlanguage.github.io/">D Language</vendor>

    <description><![CDATA[
     <img src="https://avatars3.githubusercontent.com/u/565913?v=3&s=60" alt="" />
     <p>Support for the <a href="https://dlang.org/">D Language</a>.</p>
     <p>Also adds support for using the <a href="https://code.dlang.org/">dub</a> build tool.</p>
     <p>Project available on <a href="https://github.com/intellij-dlanguage/intellij-dlanguage/">Github</a>.</p>
    ]]></description>

    <change-notes><![CDATA[
        <b>v1.26</b><br/>
        <ul>
            <li>Compatibility IntelliJ 2020.3.* - 2021.1.*</li>
            <li>Fix path passed to gdb on Windows</li>
            <li>Use new syntax for dub fetch</li>
            <li>Fix for null pointer when retrieving ModuleRootManager</li>
        </ul>
    ]]>
    </change-notes>

    <!-- please see http://confluence.jetbrains.com/display/IDEADEV/Build+Number+Ranges for description -->
    <idea-version since-build="203" until-build="211.*"/>

    <!-- We want to support IntelliJ IDEA and CLion
        see http://confluence.jetbrains.com/display/IDEADEV/Plugin+Compatibility+with+IntelliJ+Platform+Products
    -->
    <depends>com.intellij.modules.lang</depends>
    <depends>com.intellij.modules.platform</depends>
    <!--<depends>com.intellij.modules.vcs</depends>-->
    <!--<depends>com.intellij.modules.xml</depends>-->
    <!--<depends>com.intellij.modules.xdebugger</depends>-->
    <depends optional="true" config-file="idea-only.xml">com.intellij.modules.java</depends>
    <!--<depends optional="true" config-file="idea-ultimate-only.xml">com.intellij.modules.ultimate</depends>-->

    <!-- Both AppCode and CLion use cidr.lang -->
    <depends optional="true" config-file="clion-only.xml">com.intellij.modules.cidr.lang</depends>
    <!--<depends optional="true" config-file="clion-only.xml">com.intellij.modules.clion</depends>-->
    <!--<depends optional="true" config-file="appcode-only.xml">com.intellij.modules.appcode</depends>-->

    <extensions defaultExtensionNs="com.intellij">

        <!-- Add your extensions here -->
        <codeInsight.parameterInfo language="D" implementationClass="io.github.intellij.dlanguage.codeinsight.ParameterInfo"/>
        <codeInsight.parameterInfo
            implementationClass="io.github.intellij.dlanguage.codeinsight.ConstructorParameterInfo"
            language="D"/>
        <codeInsight.parameterInfo
            implementationClass="io.github.intellij.dlanguage.codeinsight.TemplateParameterInfo"
            language="D"/>
        <errorHandler implementation="io.github.intellij.dlanguage.errorreporting.DErrorReporter"/>
        <stubElementTypeHolder class="io.github.intellij.dlanguage.psi.DlangTypes"/>

        <fileTypeFactory implementation="io.github.intellij.dlanguage.DlangFileTypeFactory"/>
        <!--   todo: replace fileTypeFactory with something like: <fileType name="D file" extensions="d;di" implementationClass="io.github.intellij.dlanguage.DlangFileType" language="D"/> -->

        <lang.parserDefinition language="D" implementationClass="io.github.intellij.dlanguage.DLangParserDefinition"/>

        <lang.syntaxHighlighterFactory language="D" implementationClass="io.github.intellij.dlanguage.highlighting.DHighlighterFactory"/>
        <highlightUsagesHandlerFactory implementation="io.github.intellij.dlanguage.highlighting.exitpoint.DHighlightExitPointsHandlerFactory"/>

        <colorSettingsPage implementation="io.github.intellij.dlanguage.colors.DColorSettingsPage"/>

        <!-- Annotator -->

        <annotator language="D" implementationClass="io.github.intellij.dlanguage.annotator.DHighlightingAnnotator"/>
        <externalAnnotator language="D"
                           implementationClass="io.github.intellij.dlanguage.highlighting.annotation.external.DExternalAnnotator"/>
        <lang.documentationProvider language="D"
                                    implementationClass="io.github.intellij.dlanguage.features.DDocumentationProvider"/>
        <!-- Refactoring -->

        <renameFileActionProvider implementation="io.github.intellij.dlanguage.refactoring.DlangRenameFileActionProvider"/>

        <lang.refactoringSupport language="D"
                                 implementationClass="io.github.intellij.dlanguage.refactoring.DRefactoringSupportProvider"/>


        <!-- D Language support -->
        <sdkType implementation="io.github.intellij.dlanguage.DlangSdkType"/>
        <projectSdkSetupValidator implementation="io.github.intellij.dlanguage.DLangProjectDmdSetupValidator"/>
        <runConfigurationProducer implementation="io.github.intellij.dlanguage.run.DlangRunDubConfigurationProducer"/>

        <!-- module -->
        <moduleType id="DLANGUAGE_MODULE" implementationClass="io.github.intellij.dlanguage.module.DlangModuleType"/>


        <configurationType implementation="io.github.intellij.dlanguage.run.DlangRunDubConfigurationType"/>
        <programRunner implementation="io.github.intellij.dlanguage.run.DubBuildRunner"/>
        <consoleFilterProvider implementation="io.github.intellij.dlanguage.run.DubConsoleFilterProvider"/>
        <analyzeStacktraceFilter implementation="io.github.intellij.dlanguage.run.DubBuildSourceFileFilter"/>

        <configurationType implementation="io.github.intellij.dlanguage.run.DlangRunDmdConfigurationType"/>
        <programRunner implementation="io.github.intellij.dlanguage.run.DmdBuildRunner"/>

        <configurationType implementation="io.github.intellij.dlanguage.run.DlangRunAppConfigurationType"/>
        <programRunner implementation="io.github.intellij.dlanguage.run.RunAppRunner"/>


        <moduleConfigurationEditorProvider
            implementation="io.github.intellij.dlanguage.module.DlangModuleEditorsProvider"/>

        <!-- library -->
        <library.type implementation="io.github.intellij.dlanguage.library.DlangLibraryType"/>
        <orderRootType implementation="io.github.intellij.dlanguage.library.LibFileRootType" id="LIBRARY_FILE"
                       order="FIRST"/>
        <OrderRootTypeUI key="LIBRARY_FILE"
                         implementationClass="io.github.intellij.dlanguage.library.LibFileRootTypeUIFactory"/>

        <!-- Indexes -->
        <fileBasedIndex implementation="io.github.intellij.dlanguage.index.DModuleIndex"/>
        <stubIndex implementation="io.github.intellij.dlanguage.stubs.index.DAllNameIndex"/>
        <stubIndex implementation="io.github.intellij.dlanguage.stubs.index.DTopLevelDeclarationIndex"/>
        <stubIndex implementation="io.github.intellij.dlanguage.stubs.index.DModuleDeclarationIndex"/>
        <stubIndex implementation="io.github.intellij.dlanguage.stubs.index.DTopLevelDeclarationsByModule"/>
        <stubIndex implementation="io.github.intellij.dlanguage.stubs.index.DPublicImportIndex"/>
        <stubIndex implementation="io.github.intellij.dlanguage.stubs.index.DMembersIndex"/>
        <gotoSymbolContributor implementation="io.github.intellij.dlanguage.features.DChooseByNameContributor"/>
        <gotoClassContributor implementation="io.github.intellij.dlanguage.features.DClassContributor"/>
        <!-- Project settings -->

        <!-- Tab under compiler in IntelliJ -> Preferences -->
        <!--<projectConfigurable instance="io.github.intellij.dlanguage.DLanguageCompilerConfigurable"-->
        <!--parentId="project.propCompiler" id="DMD compiler"-->
        <!--displayName="DMD Compiler"/>-->
        <!-- Persistent data + build server communication for compiler settings -->
        <projectService serviceImplementation="io.github.intellij.dlanguage.settings.DLanguageBuildSettings"/>

        <!-- plugin settings are now in: Settings -> Languages &amp; Frameworks -> D Tools -->
        <projectConfigurable id="DToolSettings" groupId="language" displayName="D Tools"
                             instance="io.github.intellij.dlanguage.settings.DLanguageToolsConfigurable"/>

        <!-- File -> Project Structure dialogue. -->
        <!--<moduleConfigurationEditorProvider implementation="io.github.intellij.dlanguage.settings.DLanguageModuleConfigurationEditor" order="first"/>-->
        <!-- Tab in IntelliJ -> Preferences -->

        <!-- References/navigation -->
        <psi.referenceContributor implementation="io.github.intellij.dlanguage.psi.references.DReferenceContributor"/>
        <lang.findUsagesProvider language="D"
                                 implementationClass="io.github.intellij.dlanguage.codeinsight.DFindUsagesProvider"/>

        <!-- Editing utils -->
        <lang.braceMatcher language="D" implementationClass="io.github.intellij.dlanguage.features.DBraceMatcher"/>
        <lang.commenter language="D" implementationClass="io.github.intellij.dlanguage.features.DCommenter"/>

        <completion.contributor language="D"
                                implementationClass="io.github.intellij.dlanguage.codeinsight.DCompletionContributor"/>

        <!-- folding -->
        <lang.foldingBuilder language="D" implementationClass="io.github.intellij.dlanguage.folding.DFoldingBuilder"/>
        <codeFoldingOptionsProvider instance="io.github.intellij.dlanguage.folding.DCodeFoldingOptionsProvider"/>
        <applicationService serviceInterface="io.github.intellij.dlanguage.folding.DCodeFoldingSettings"
                            serviceImplementation="io.github.intellij.dlanguage.folding.impl.DCodeFoldingSettingsImpl"/>

        <!--  <completion.contributor language="D"
                                  implementationClass="io.github.intellij.dlanguage.codeinsight.DCompletionContributorImports"/>-->

        <!-- Surrounders -->
        <!-- // a placeholder for later to enable language specific template expansion. -->
        <!--<lang.surroundDescriptor language="D"
                                 implementationClass="io.github.intellij.dlanguage.template.DlangExpressionSurroundDescriptor"/>-->

        <!-- Live Templates -->
        <defaultLiveTemplatesProvider implementation="io.github.intellij.dlanguage.template.DlangLiveTemplatesProvider"/>

        <liveTemplateContext implementation="io.github.intellij.dlanguage.template.DlangContext"/>
        <!--<liveTemplateContext implementation="io.github.intellij.dlanguage.template.DlangContextType$Statement"/>-->
        <!--<liveTemplateContext implementation="io.github.intellij.dlanguage.template.DlangContextType$Item"/>-->
        <!--<liveTemplateContext implementation="io.github.intellij.dlanguage.template.DlangContextType$Struct"/>-->
        <!--<liveTemplateContext implementation="io.github.intellij.dlanguage.template.DlangContextType$Mod"/>-->
        <!--<liveTemplateContext implementation="io.github.intellij.dlanguage.template.DlangContextType$Attribute"/>-->

        <!--<liveTemplateMacro implementation="io.github.intellij.dlanguage.template.macros.DlangSuggestIndexNameMacro"/>-->
        <!--<liveTemplateMacro implementation="io.github.intellij.dlanguage.template.macros.DlangCollectionElementNameMacro"/>-->

        <!--formatter-->
        <lang.formatter
            implementationClass="io.github.intellij.dlanguage.features.formatter.DFormattingModelBuilder"
            language="D"/>
        <codeStyleSettingsProvider implementation="io.github.intellij.dlanguage.features.formatter.settings.DCodeStyleSettingsProvider"/>
        <langCodeStyleSettingsProvider implementation="io.github.intellij.dlanguage.features.formatter.settings.DLanguageCodeStyleSettingsProvider"/>

        <!-- dunit support -->
        <configurationType implementation="io.github.intellij.dlanguage.unittest.DUnitTestRunConfigurationType"/>
        <runConfigurationProducer implementation="io.github.intellij.dlanguage.unittest.DUnitTestRunConfigurationProducer"/>
        <programRunner implementation="io.github.intellij.dlanguage.unittest.DUnitTestProgramRunner"/>
        <!--<testFramework implementation="io.github.intellij.dlanguage.unittest.DUnitTestFramework"/>-->
        <!--<testFinder implementation="io.github.intellij.dlanguage.unittest.DUnitTestFinder"/>-->
        <!--<consoleFilterProvider implementation="io.github.intellij.dlanguage.unittest.DStackTraceFilter"/>-->
        <!--<analyzeStacktraceFilter implementation="io.github.intellij.dlanguage.unittest.DStackTraceFilter"/>-->

        <!--inspections-->
        <localInspection language="D" shortName="PossiblyUndefinedSymbol" bundle="i18n"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="io.github.intellij.dlanguage.inspections.PossiblyUndefinedSymbol"
                         groupKey="d.inspections.groupname"
                         key="d.inspections.symbol.possiblyundefinedsymbol.displayname"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.ImplicitlyConcatenatedStrings"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.implicitlyconcatenatedstrings.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="ImplicitlyConcatenatedStrings"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.OldAliasSyntax"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.oldaliassyntax.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="OldAliasSyntax"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.EmptyStatement"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.emptystatement.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="EmptyStatement"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.DeleteStatementsAreDeprecated"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.deletestatementsaredeprecated.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="DeleteStatementsAreDeprecated"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.FunctionShouldBeConst"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.functionshouldbeconst.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="FunctionShouldBeConst"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.AutoFunctionWithoutReturn"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.autofunctionwithoutreturn.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="AutoFunctionWithoutReturn"/>
        <localInspection bundle="i18n" enabledByDefault="true"
                         implementationClass="io.github.intellij.dlanguage.inspections.BuiltinPropertyName"
                         language="D" level="WARNING"
                         key="d.inspections.symbol.builtinpropertyname.displayname"
                         groupKey="d.inspections.groupname"
                         shortName="BuiltinPropertyName"/>

        <!--debugger-->
        <!--<configurationType implementation="uk.co.cwspencer.ideagdb.run.GoGdbRunConfigurationType"/>-->
        <!--<programRunner implementation="uk.co.cwspencer.ideagdb.run.GdbRunner"/>-->
        <xdebugger.breakpointType implementation="uk.co.cwspencer.ideagdb.debug.breakpoints.GdbBreakpointType"/>

        <!-- Structure View -->
        <lang.psiStructureViewFactory language="D" implementationClass="io.github.intellij.dlanguage.structure.DStructureViewFactory"/>


        <postStartupActivity
            implementation="io.github.intellij.dlanguage.project.DubListenerComponent"/>
    </extensions>

    <application-components>
        <!-- Add your application components here -->
    </application-components>

    <actions>
        <action id="DLanguage.NewDLanguageClass" class="io.github.intellij.dlanguage.actions.CreateDlangClassAction"
                text="D Class" description="Create new D Class">
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFile"/>
        </action>
        <action id="DLanguage.DFormat"
                class="io.github.intellij.dlanguage.actions.DFormatAction"
                text="Reformat Code with DFormat"
                description="Format current file with DFormat formatter">
            <add-to-group group-id="CodeFormatGroup" anchor="last"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt K"/>
        </action>
        <action id="DLanguage.DFix"
                class="io.github.intellij.dlanguage.actions.DFixAction"
                text="Fix D Code with DFix"
                description="Fix current file with DFix">
            <add-to-group group-id="CodeFormatGroup" anchor="last"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt M"/>
        </action>
        <action id="io.github.intellij.dlanguage.RestartDCD" class="io.github.intellij.dlanguage.actions.RestartDCD"
                text="Restart DCD Server" description="Restarts the DCD server">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        <action id="io.github.intellij.dlanguage.ProcessDLibs" class="io.github.intellij.dlanguage.actions.ProcessDLibs"
                text="Process D Libraries" description="Processes the D Libraries">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>

    <module-components>
        <component>
            <implementation-class>io.github.intellij.dlanguage.codeinsight.dcd.DCDCompletionServer</implementation-class>
        </component>
    </module-components>

    <project-components>
        <!-- Add your project components here -->
    </project-components>


</idea-plugin>
